<h1>
    test <br>
    {{ test }}
</h1>

<form method="post" enctype="multipart/form-data" id="upload-form">
    {% csrf_token %}
    <input type="file">
    <button type="button" id="send-button">Send</button>
</form>

<script>
    // Add a click event listener to the button
    document.getElementById('send-button').addEventListener('click', function () {
        event.preventDefault();
        // Get the file to upload
        const fileInput = document.querySelector('input[type="file"]');
        const file = fileInput.files[0];

        // Create a FormData object
        const formData = new FormData();

        // Add the file to the FormData object
        formData.append('file', file);

        // Create an XMLHttpRequest object
        const xhr = new XMLHttpRequest();

        // Set the request method and URL
        xhr.open('POST', 'http://localhost:8000/api/v1/separate');

        // Set the response type to 'blob' to handle binary data
        xhr.responseType = 'blob';

        // Send the request
        xhr.send(formData);

        // Listen for the response
        xhr.onload = function () {
            if (xhr.status === 200) {
                // The request was successful
                console.log("successful");

                // Create a URL for the ZIP blob
                const zipBlob = xhr.response;
                const zipUrl = URL.createObjectURL(zipBlob);

                // Create a download link for the ZIP file
                const downloadLink = document.createElement('a');
                downloadLink.href = zipUrl;
                downloadLink.download = 'separated_audio.zip';
                downloadLink.textContent = 'Download Separated Audio';

                // Append the download link to the page
                document.body.appendChild(downloadLink);

                // Click the download link to trigger the download
                downloadLink.click();
            } else {
                // The request failed
                console.log("error happened");
                console.error(xhr.statusText);
            }
        };
    });
</script>
